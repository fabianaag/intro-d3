<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <title>Barras simples</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
</head>

<body>
  <div class="container">
    <div class="row">
      <h2>Barras com dados findos de uma url</h2>
    </div>
    <div class="row mychart" id="chart">
    </div>
  </div>

  <style>
    .mychart rect {
      fill: steelblue;
    }

    .mychart rect:hover {
      fill: goldenrod;
    }

    .mychart text {
      font: 12px sans-serif;
      text-anchor: left;
    }
  </style>

  <script type="text/javascript">
    "use strict"

    function desenhaBarras(dados) {
      var largura = 200,
          altura = 500;

      const posicaoBarraX = 0;
      const posicaoBarraY = altura / dados.length;
      const larguraBarra = altura / dados.length - 2;

      var svg = d3.select('#chart')
                .append('svg')
                .attr('width', largura)
                .attr('height', altura);

      /* Edite o código abaixo para criar um gráfico de barras horizontais
       *
       * Crie funções que a partir dos dados definem os atributos x, y, width
       * e height dos retângulos que são as barras.
       *
       * Dica: você pode criar funções de dois parâmetros (function(d, i)) para
       * isso, onde o primeiro (d) é o dado e o segundo (i) é o índice desse dado.
       * O índice é importante para dizer onde a barra será desenhada, por exemplo.
       * (Nem pense em fazer hardcoded :)).
       */
      svg.selectAll('rect')
          .data(dados)
          .enter()
            .append('rect')
              .attr('x', posicaoBarraX) // A função com dois parâmetros pode entrar aqui
              .attr('y', function(d, i){return i * posicaoBarraY}) // e aqui
              .attr('width', function(d){return 1000 * d.valor})
              .attr('height', larguraBarra);
    }

    d3.tsv('dados/alphabet.tsv', function(dados) {
      console.log("provavelmente acontece depois")
      desenhaBarras(dados);
    });

    console.log("provavelmente acontece primeiro") // me apague quando entender.

    /*
    * Assim como a função d3.tsv, existe a d3.csv e a d3.json
    * Em todas, o primeiro parâmetro é uma URL e o segundo a função que
    * será executada quando o dado for obtido.
    * >>>>> A chamada ao d3.tsv é assíncrona <<<<<<
    */
  </script>
</body>

</html>
